@model E_OneWeb.Models.ViewModels.RoomReservationUserVM

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var title = "Data Peminjam";
}

<br />
<div class="row"> 
    <br />
    <input type="hidden" value="@ViewBag.img" />
    <input type="hidden" asp-for="RoomReservationUser.Id" id="IdResUser" />
    <input type="hidden" value="@ViewBag.fileDownload" id="filedownload" />
    <input type="hidden" asp-for="RoomReservationUser.Status" id="statusApprove" />
    <div class="row p-3 border">

        <div class="col-12 border-bottom">
            <h2 class="text-primary">Pinjam Ruangan</h2>
        </div>
        <div class="col-12 pt-2">
            <div class="form-group row">
                <div class="col-2">
                    Nama Ruangan
                </div>
                <div class="col-4">
                    <div class="input-group">
                        <input asp-for="RoomReservationUser.RoomReservationAdmin.RoomName" id="RoomName" class="form-control" disabled />
                    </div>
                </div>
                <div class="col-2">
                    Lokasi Gedung
                </div>
                <div class="col-4">
                    <input asp-for="RoomReservationUser.RoomReservationAdmin.LocationName" class="form-control" style="row-gap" id="LocationName" disabled />

                </div>
            </div>

        </div>
      
        <div class="col-12 pt-2">
            <div class="form-group row">
                <div class="col-2">
                    Mata Kuliah
                </div>
                <div class="col-4">
                    <input asp-for="RoomReservationUser.Study" class="form-control" style="row-gap" disabled />
                </div>
                <div class="col-2">
                    Dosen
                </div>
                <div class="col-4">
                    <input asp-for="RoomReservationUser.Dosen" class="form-control" style="row-gap" disabled />
                </div>
            </div>

        </div>
        <div class="col-12 pt-2">
            <div class="form-group row">
                <div class="col-2">
                    <label>Tanggal Peminjaman</label>
                </div>
                <div class="col-4">
                    <input asp-for="RoomReservationUser.StartDate" class="form-control" type="date" disabled />
                </div>
                <div class="col-2">
                    <label>Dari Jam</label>
                </div>
                <div class="col-4">
                    <input asp-for="StartDate" type="text" id="timepickerStart" class="form-control" disabled />
                </div>

            </div>

        </div>
        <div class="col-12 pt-2">
            <div class="form-group row">
                <div class="col-2">
                    <label>Tanggal Selesai</label>
                </div>
                <div class="col-4">
                    <input asp-for="RoomReservationUser.EndDate" class="form-control" type="date" disabled />
                </div>
                <div class="col-2">
                    <label>Sampai Jam</label>
                </div>
                <div class="col-4">
                    <input asp-for="EndDate" type="text" id="timepickerEnd" class="form-control" disabled />
                </div>

            </div>

        </div>
        <div class="col-12 pt-2">
            <div class="form-group row">
                <div class="col-2">
                    Keperluan
                </div>
                <div class="col-4">
                    <textarea asp-for="RoomReservationUser.Description" class="form-control" disabled></textarea>
                </div>
                <div class="col-2">
                    Mengetahui
                </div>
                <div class="col-4">
                    <input asp-for="RoomReservationUser.ApproveBy" class="form-control" style="row-gap" disabled />
                </div>
              
            </div>

        </div>
    
        <div class="col-md-12">
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">  
                <button class="btn btn-primary" type="button" title="Approved" onclick="Approved()" style="width:145px" id="btn-approve"><i class="fa fa-check" aria-hidden="true"></i>&nbsp; Approve</button>
                <button class="btn btn-danger" type="button" title="Rejected" data-bs-toggle="modal" data-bs-target="#modalreject" style="width:145px" id="btn-reject"><i class="fa fa-times" aria-hidden="true"></i>&nbsp; Reject</button>
                <button class="btn btn-primary" type="button" title="Download file" onclick="Export()" id="exportfile"><i class="fas fa-file-download"></i>&nbsp; Download File</button>
            </div>

        </div>
        <br/>

        <div class="col-12 border-bottom py-2">
            <h2 class="text-primary">@title</h2>
        </div>
        <div class="col-md-8">
            <div class="form-floating py-2">
                <input asp-for="Personal.UserName" class="form-control" placeholder="User Name" disabled />
                <label class="form-label">User Login</label>
            </div>

            <div class="form-floating py-2">
                <input asp-for="Personal.FullName" placeholder="Name Lengkap" class="form-control" disabled />
                <label class="form-label">Name Lengkap</label>
            </div>

            <div class="form-floating py-2">
                <input asp-for="Personal.NIM" placeholder="NIM" class="form-control" disabled />
                <label class="form-label">NIM</label>
            </div>

            <div class="form-floating py-2">
                <input asp-for="Personal.Prodi" class="form-control" placeholder="Prodi" disabled />
                <label class="form-label">Prodi</label>

            </div>

            <div class="form-floating py-2">
                <input asp-for="Personal.Fakultas" class="form-control" placeholder="Fakultas" disabled />
                <label class="form-label">Fakultas</label>

            </div>

            <div class="form-floating py-2">
                <input asp-for="Personal.PhoneNumber" class="form-control" placeholder="Phone Number" disabled />
                <label class="form-label">Phone Number</label>
            </div>

        </div>
        <div class="col-md-4">   
         

            <div class="card border-0 p-3 shadow  border-top border-5 rounded">
                @if (@ViewBag.img != "")
                {                   
                    <div class="card" style="-ms-text-autospace">
                        <img class="card-img-top rounded" src="@Model.Personal.Photo">
                    </div>
                }
                else
                {
                    <div class="card" style="width: 18rem;">
                        <img class="rounded float-end" src="https://placehold.co/300x400/png" style="border-radius:5px; border:1px solid #bbb9b9">
                    </div>
                }              
            </div>
        </div>


        <br />

        <div class="form-group row py-4">
            <div class="col-5 offset-5">
                <div class="row">
                    <div class="col">
                        <a asp-action="Index" style="width:215px" class="btn btn-success form-control">Back to List</a>
                    </div>

                </div>
            </div>
        </div>


    </div>



</div>

<!-- Modal -->
<div class="modal fade" id="modalreject" tabindex="-1" aria-labelledby="lookupLabel" aria-hidden="true">
    <div class="modal-dialog modal-m">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="lookupLabel">Apakah Anda yakin ingin Menolak?</h4>
            </div>
            <div class="modal-body">
                <div class="col-12 pt-2">
                    <div class="form-group row">
                        @Html.LabelFor(model => model.RoomReservationUser.Notes, "Catatan", htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-10">
                            <div class="input-group">
                                <textarea asp-for="RoomReservationUser.Notes" id="notes" class="form-control"></textarea>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="modal-footer">
                <div class="form-group margin-bottom-2">
                    <div class="col-md-12 text-center">
                        <button type="button" class="btn btn-secondary text-white" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" onclick="Rejected()" data-bs-dismiss="modal">Ok</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script type="text/javascript">
        $(document).ready(function () {

            if ($("#filedownload").val() == "true") {
                $("#exportfile").removeAttr("disabled");
            } else {
                $("#exportfile").attr("disabled", "disabled");
            }
            var status = $("#statusApprove").val();
            if (status == "Approved") {
                $("#btn-approve").attr("disabled", "disabled");
            } else if (status == "Rejected") {
                $("#btn-reject").attr("disabled", "disabled");
            }
            else {
                $("#btn-approve").removeAttr("disabled");
                $("#btn-reject").removeAttr("disabled");
            }

        });
        function Export() {
            var id = $('#IdResUser').val();
            var urlx = "/Admin/RoomReservationAdmin/Export/" + id;
            window.location = urlx;

        }

        function Approved() {
            var id = $('#IdResUser').val();
            var url = "/Admin/RoomReservationAdmin/Approve/" + id;
            swal({
                title: "Apakah Anda yakin ingin Menyetujui?",
                //text: "You will not be able to restore the data!",
                icon: "success",
                buttons: true,
                reverseButtons: true
            }).then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        type: "POST",
                        url: url,
                        success: function (data) {
                            if (data.success) {
                                toastr.success(data.message);
                                dataTable.ajax.reload();
                            }
                            else {
                                toastr.error(data.message);
                            }
                        }
                    });
                }
            });
        }

        function Rejected() {

            var id = $('#IdResUser').val();
            var note = $('#notes').val();
            var urls = "/Admin/RoomReservationAdmin/Rejected?note=" + note + "&id=" + id;

            try {
                $.ajax({
                    url: urls,
                    dataType: 'json',
                    type: 'POST',
                    contentType: 'application/json;',
                    success: function (data) {
                        if (data.success) {
                            $('#notes').val('')
                            toastr.success(data.message);
                            dataTable.ajax.reload();
                        }
                        else {
                            toastr.error(data.message);
                        }

                    },
                    error: function (request, status, error) {
                        console.log(status);
                        console.log(urls, status, error.toString());
                        console.log("error" + error);

                    }
                });

            } catch (e) {

            }

        }

    </script>


}



