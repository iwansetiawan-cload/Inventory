
@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    var status = Context.Request.Query["status"];
    var title = "Reservation";
    var all = "text-primary";
    var avalable = "text-primary";
    var waiting_approval = "text-primary";
    var room_in_use = "text-primary";

    switch (status)
    {
        case "avalable":
            avalable = "active text-white";
            break;
        case "waiting_approval":
            waiting_approval = "active text-white";
            break;
        case "room_in_use":
            room_in_use = "active text-white";
            break;
        default:
            all = "active text-white";
            break;
    }
}
<br />
<div class="row">
    <div class="col-md-12">
        <div class="col-md-6">
            <h2 class="text-primary">@title </h2>
        </div>

    </div>
</div>
<br />
<div class="border p-3">
    <div class="d-flex justify-content-between justify-content-md-end mb-3">
        <div class="p-2">
            <ul class="list-group list-group-horizontal-sm">
                <a style="text-decoration:none;" asp-controller="RoomReservationAdmin"
                   asp-action="Index" asp-route-status="avalable">
                <li class="list-group-item @avalable">Room avalable</li>
                </a>
                <a style="text-decoration:none;" asp-controller="RoomReservationAdmin"
                   asp-action="Index" asp-route-status="waiting_approval">
                <li class="list-group-item @waiting_approval">Waiting approval</li>
                </a>
                <a style="text-decoration:none;" asp-controller="RoomReservationAdmin"
                   asp-action="Index" asp-route-status="room_in_use">
                <li class="list-group-item @room_in_use">Room in use</li>
                </a>              
                <a style="text-decoration:none;" asp-controller="RoomReservationAdmin"
                   asp-action="Index" asp-route-status="all">
                <li class="list-group-item @all">All</li>
                </a>
            </ul>
        </div>
    </div>

@*
    <br /><br />*@

    <table id="tblDataRoomReservationAdmin" class="table table-striped table-bordered" style="width:100%">
        <thead class="thead-dark">
            <tr class="table-info">
                <th>
                    Room Name
                </th>
                <th>
                    Location Name
                </th>
                <th>
                    Status
                </th>
                <th>
                    Booking By
                </th>
                <th>
                    Start Date
                </th>
                <th>
                    End Date
                </th>
                <th></th>
                <th style="display:none">                   
                </th>
            </tr>
        </thead>
    </table>

</div>


@section Scripts{


    <script type="text/javascript">
        $(document).ready(function () {
            var url = window.location.search;
            if (url.includes("avalable")) {
                loadDataTable("GetOrderList?status=avalable");
            }
            else {
                if (url.includes("waiting_approval")) {
                    loadDataTable("GetOrderList?status=waiting_approval");
                }
                else {
                    if (url.includes("room_in_use")) {
                        loadDataTable("GetOrderList?status=room_in_use");
                    }
                    else {
                        loadDataTable("GetOrderList?status=all");
                    }
                }
            }        
       
        });       

        function loadDataTable(url) {
            dataTable = $('#tblDataRoomReservationAdmin').DataTable({
                "ajax": {
                    "url": "/Admin/RoomReservationAdmin/" + url
                },
                "columns": [
                    { "data": "roomname", "autoWidth": true },
                    { "data": "locationname", "autoWidth": true },
                    { "data": "status", "autoWidth": true },
                    { "data": "bookingby", "autoWidth": true },
                    { "data": "startdate", "autoWidth": true },
                    { "data": "enddate", "autoWidth": true },
                    { "data": "id", "autoWidth": true },
                    { "data": "flag", "autoWidth": true }

                ],
                "createdRow": function (row, data, index) {
                    //$('td', row).eq(5).attr('style', 'display:none;');
                    var urls = "/Admin/RoomReservationAdmin/Approve/" + data["id"];
                    $('td', row).eq(7).attr('style', 'display:none;');
                    if (data["flag"] == '1') {
                        $('td', row).eq(6).html("<a class='btn btn-success btn-xs btn-edit' title='approved'' onclick=Approved('" + urls + "')><i class='fas fa-check'></i></a>");
                    }else{
                        $('td', row).eq(6).html("");
                    }
                    $('td', row).eq(6).attr('style', 'min-width: 20px; text-align: center; width: 13px;');
                }
            });
        }        

        function Approved(url) {
            swal({
                title: "Are you sure you want to Approve?",
                text: "You will not be able to restore the data!",
                icon: "warning",
                buttons: true,
                dangerMode: true
            }).then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        type: "POST",
                        url: url,
                        success: function (data) {
                            if (data.success) {
                                toastr.success(data.message);
                                dataTable.ajax.reload();
                            }
                            else {
                                toastr.error(data.message);
                            }
                        }
                    });
                }
            });
        }
        
       
    </script>
}



